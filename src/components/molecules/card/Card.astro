---
import CardButton from "@/components/atoms/buttons/CardButton.astro";
import githubIcon from "@/assets/icons/github.svg";
import websiteIcon from "@/assets/icons/website.svg";
import CardTech from "@/components/atoms/buttons/CardTech.astro";
import type { CardLinks } from "./card.model";
import type { Badge } from "@/data/badges";

interface Props {
  imgSrc: string;
  imgAlt: string;
  title: string;
  subheader?: string[];
  description: string;
  links: CardLinks;
  badges: Badge[];
}

const { imgSrc, imgAlt, title, subheader, description, links, badges } =
  Astro.props;

function parseSubheaderData(subheader: string[]): string {
  return subheader.join(" | ");
}
---

<div
  class={`card-container card-reveal flex flex-col-reverse lg:flex-row gap-12 justify-between p-10 w-full max-w-5xl m-0 rounded-xl`}
>
  <div class="flex flex-col md:flex-row gap-8">
    <img class="w-40 h-40 object-contain" src={imgSrc} alt={imgAlt} />
    <div class="flex flex-col gap-4 max-w-xl">
      <div class="flex flex-col gap-2">
        <h3 class="font-semibold text-3xl">{title}</h3>
        {
          subheader && (
            <h4 class="font-semibold text-lg">
              {parseSubheaderData(subheader)}
            </h4>
          )
        }
      </div>
      <p class="whitespace-pre-line">{description}</p>
      <div class="flex flex-row gap-3">
        {
          links.repoUrl && (
            <CardButton
              label="Github"
              iconSrc={githubIcon.src}
              url={links.repoUrl}
              altText="Github"
              color="--primary-black-400"
              turnIconWhite={true}
            />
          )
        }
        {
          links.websiteUrl && (
            <CardButton
              label="Website"
              url={links.websiteUrl}
              iconSrc={websiteIcon.src}
              altText="Website"
              color="--secondary-purple-400"
              turnIconWhite={true}
            />
          )
        }
      </div>
    </div>
  </div>
  <div class="flex flex-row flex-wrap lg:flex-col gap-2">
    {badges.map((v) => <CardTech imageUrl={v.imageUrl} altText={v.name} />)}
  </div>
</div>

<style>
  .card-container {
    border: 1px solid var(--primary-black-500);
    background: var(--neutral-gray-100);
    box-shadow:
      5px 5px 0px var(--neutral-gray-500),
      -5px -5px 0px var(--neutral-white);
  }

  .card-reveal {
    opacity: 0;
    transform: translateY(60px);
    transition:
      opacity 1.2s ease-out,
      transform 1.2s ease-out;
  }

  .card-reveal.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  function initCardReveal() {
    const cards = document.querySelectorAll(".card-reveal");

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("visible");
          }
        });
      },
      {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
      },
    );

    cards.forEach((card) => {
      observer.observe(card);
    });
  }

  // Ejecutar cuando el DOM esté listo
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initCardReveal);
  } else {
    initCardReveal();
  }

  // Re-ejecutar en navegación de Astro
  document.addEventListener("astro:page-load", initCardReveal);
</script>
